<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>縄文土器 図鑑｜クイズラリー</title>
    <link rel="stylesheet" href="assets/css/style.css"/>
    <script defer src="assets/js/state.js"></script>
    <script defer>
      document.addEventListener('DOMContentLoaded', () => {
        const {ARTIFACTS, isSolved, solvedCount, potIMG} = window.JomonQuiz;
        const grid = document.querySelector('#grid');
        const iconGrid = document.querySelector('#iconGrid');
        const total = ARTIFACTS.length;
        const solved = solvedCount();
        document.querySelector('#count').textContent = `${solved}/${total}`;
        document.querySelector('#barfill').style.width = `${Math.round(solved/total*100)}%`;

        const sortedById = ARTIFACTS.slice().sort((a, b) => a.id.localeCompare(b.id));
        if(iconGrid){ iconGrid.innerHTML = ''; }
        grid.innerHTML = '';

        sortedById.forEach(art => { //これに変更
          const card = document.createElement('div');
          card.className = 'card';
          card.setAttribute('data-artifact-id', art.id);
          const solvedThis = isSolved(art.id);

          if(iconGrid){
             const iconCard = document.createElement('div');
             iconCard.className = 'icon-card';
             const iconWrap = document.createElement('div');
             iconWrap.className = 'icon-card__visual';
             iconWrap.innerHTML = potSVG({color: art.potColor, solved: solvedThis});
             iconCard.appendChild(iconWrap);
             const iconName = document.createElement('div');
             iconName.className = 'icon-card__label';
             iconName.textContent = art.name;
             iconCard.appendChild(iconName);
             iconGrid.appendChild(iconCard);
            }

          const potWrap = document.createElement('div');
          potWrap.className = 'pot-wrap';
          potWrap.innerHTML = potIMG({src: art.imageUrl, solved: solvedThis,alt: art,name});
          card.appendChild(potWrap);

          const title = document.createElement('div');
          title.className = 'title';
          title.textContent = art.name;
          card.appendChild(title);

          const site = document.createElement('div');
          site.className = 'muted';
          site.textContent = art.site;
          card.appendChild(site);

          const chip = document.createElement('div');
          chip.className = 'badge';
          // chip.textContent = solvedThis ? 'クリア済み' : '未クリア';
          card.appendChild(chip);

          const actions = document.createElement('div');
          actions.className = 'actions';
          const btnExplain = document.createElement('a');
          btnExplain.className = 'button';
          btnExplain.href = `pages/explain.html?id=${art.id}`;
          // btnExplain.textContent = '説明を見る';
        　actions.appendChild(btnExplain);

          const btnQuiz = document.createElement('a');
          btnQuiz.className = 'button primary';
          btnQuiz.href = `pages/quiz.html?id=${art.id}`;
          // btnQuiz.textContent = solvedThis ? 'クイズを復習' : 'クイズに挑戦';
          actions.appendChild(btnQuiz);

          const btnReward = document.createElement('a');
          btnReward.className = 'button';
          btnReward.href = `pages/reward.html?id=${art.id}`;
          btnReward.textContent = 'ごほうびを見る';
          actions.appendChild(btnReward);

          card.appendChild(actions);

          grid.appendChild(card);
        });

        document.querySelector('#reset').addEventListener('click', () => {
          if(confirm('進捗をリセットしますか？')){
            window.JomonQuiz.clearAll();
            location.reload();
          }
        });
      });
    </script>
  </head>
  <body>
    <div class="container">
      <header class="site">
        <h1>縄文土器 図鑑</h1>
        <nav>
          <span class="badge">クイズラリー</span>
        </nav>
      </header>

      <p class="lead">クイズに正解すると、シルエットだった土器に色がつきます。すべて集めてコンプリートを目指そう！</p>

      <div class="progress">
        <strong>進捗:</strong>
        <div class="bar"><span id="barfill"></span></div>
        <span id="count" class="badge">0/0</span>
      </div>

      <div class="actions" style="margin-bottom:12px">
        <button id="reset" class="warn">進捗リセット</button>
      </div>

      <section class="grid" id="grid" aria-live="polite"></section>
    </div>
  </body>
</html>
